---
title: MEV进阶学习
date: 2024-11-01
tags: 
  - 区块链
  - 最大可提取价值(MEV)
categories: 
  - MEV
---

原文链接：https://github.com/autistic-symposium/mev-toolkit

## learn (toxic and non-toxic) extraction strategies（有毒和无毒的提取策略”）

> **Toxic（有毒）提取策略**：这些策略对普通用户或整个市场生态系统可能有负面影响。例如，“三明治攻击”（sandwich attack）和“抢跑”（frontrunning）等策略会导致其他用户的交易成本增加或影响他们的交易结果。这些策略被称为“有毒”，因为它们不仅会损害用户体验，还可能破坏市场的公平性，甚至增加网络的整体成本。
>
> **Non-Toxic（无毒）提取策略**：这些策略不会直接损害其他用户的利益，甚至可能对市场的稳定性和流动性有帮助。例如，套利（arbitrage）和闪电贷（flashloan）等操作，在合理使用下不破坏市场秩序，反而可能增加市场的效率和流动性。

### 原子级（Atomic）提取策略

原子级策略依赖于特定交易的排序，以在交易链中立即获利。这类策略包括：

1. **Sniping（狙击）**：在市场中监控价格波动，并在特定的价格变化时迅速执行交易，以达到套利或获利的目的。
2. **Longtails（长尾）**：指的是在交易频率较低的资产上，通过精细的交易策略来获取高利润，因为这些资产的市场深度和价格波动较大。
3. **Atomic Arbs（原子套利）**：利用区块链上不同平台或代币之间的价格差异进行套利，通常通过“原子”操作，即在一个交易中完成买入和卖出，确保没有风险暴露。
4. **Sandwiches（三明治攻击）**：在某一交易的前后插入自己的两笔交易，通过价格滑点来获利。这通常被认为是一种“有毒”提取方式。
5. **Flashloans（闪电贷）**：利用零抵押贷款进行瞬时借贷，结合复杂的套利策略，从而在一个区块内偿还贷款并获利。
6. **JIT Liquidity（即时流动性）**：在特定的交易前快速提供流动性，然后在交易后撤回，以捕捉流动性提供者的收益。
7. **Liquidations（清算）**：在借贷协议中，抓住用户的抵押品低于借款时机进行清算，以获取清算奖励。
8. **Frontrunning（抢跑）**：在其他人的交易之前优先执行自己的交易，以获取价格优势。这种行为依赖于观察交易池中的未决交易信息。
9. **Backrunning（尾随交易）**：在某些高影响力交易之后紧跟自己的交易，以捕捉市场效应，比如价格反弹或回调。

### 统计级（Statistical）提取策略

统计级策略依赖于对市场信号或信息的深入分析，以便在更大范围的市场中获得利润。这类策略包括：

1. **Order Flows（订单流）**：分析市场的订单流量数据，了解市场的供需情况，从而提前预测价格变动。
2. **Statistical Arbs（统计套利）**：基于历史数据和统计模型，在不同资产或市场之间进行套利操作，通常依赖于高频和低延迟的交易策略。
3. **DeFi and Trading（去中心化金融与交易）**：在 DeFi 协议中进行交易，利用 DeFi 生态系统的流动性和交易机制进行套利。
4. **Cross-domain MEV（跨域MEV）**：在跨链或跨平台的交易中获取 MEV，通过跨链桥、不同协议间的交易流动捕捉价值。
5. **Oracles and TWAMM（预言机和时间加权平均市场做市商）**：利用预言机价格和时间加权平均价格的波动来获利，特别是在市场价格跟随预言机更新的情况下。

### sniping（狙击策略）

“流动性狙击”是一种 MEV 策略，通常发生在新流动性池创建之后。狙击者在流动性池刚刚创建时快速购买某种资产，通常是在资产还未被其他人大量交易之前，以期获得价格优势。这种策略的关键在于速度，因为多名狙击者在争夺在流动性池中第一时间购买的机会。

#### 核心要点：

- **狙击过程**：在流动性池创建的瞬间，狙击者会快速出手，优先购买目标资产。
- **后续卖出策略**：这些资产通常不会在同一个区块中立即抛售，而是可能在接下来的几分钟或几个小时内逐步出售，以避免因过快交易导致价格下跌。
- **不保证利润**：狙击行为不一定会带来盈利，可能因为市场波动或流动性池的变化而导致亏损。

#### 技巧：

- **爬取中继节点（crawling relays）**：通过代理网络（例如使用 Cloudflare）爬取数据来规避速率限制。这可以让狙击者快速获取关于流动性池和市场的最新信息，从而做出更快的决策。
- **维护内存缓存**：在内存中保存预测被缓存的节点列表，只访问那些预测为未缓存的节点，以提高速度和效率。
- **使用匿名代理服务器**：例如，使用 Proxymesh 等匿名代理服务，帮助狙击者在不同的节点间切换，提高隐私性并减少被检测和限制的风险。

#### 相关链接：

文档中提供了额外的参考资源：

- **[Sniper bots anatomy](https://github.com/autistic-symposium/mev-toolkit/blob/main/MEV_searchers/bots/snipers.md)**：链接提供了对狙击机器人结构的深入分析，帮助用户了解如何构建和优化狙击机器人。
- **[NFT sniping](https://deepfivalue.substack.com/p/how-our-team-makes-millions-in-crypto)**：该链接涉及 NFT 市场中的狙击策略，介绍如何在 NFT 市场中迅速购买新上市的 NFT 以获得价格优势。

#### 举例：

假设在去中心化交易所（DEX）上，一个新项目 TokenX 即将发布。项目方宣布在北京时间 10:00 会在 Uniswap 上创建一个 TokenX/ETH 流动性池，允许用户交易 TokenX。

a. **狙击者准备工作**

狙击者得知 TokenX 将在 10:00 开放流动性池。他们事先设置好了一个自动化的狙击机器人（sniper bot），该机器人会持续监控 Uniswap 的链上数据，以检测新流动性池的创建。一旦 TokenX/ETH 流动性池创建完成，机器人就会立即执行交易。

b. **流动性池创建**

当 10:00 到达时，项目方将 TokenX 和一定数量的ETH注入流动性池，TokenX/ETH 交易对正式上线。

c. **狙击机器人执行购买**

狙击机器人检测到 TokenX/ETH 池的创建，立即在当前市场价格下购买大量 TokenX。此时，由于交易刚开始，TokenX 的价格还未因大规模买入而上涨，因此狙击者可以以较低的价格购买到 TokenX。

d. **策略选择：等待价格上涨后逐步卖出**

- 如果 TokenX 受市场欢迎，更多人会陆续购买 TokenX，导致价格上升。狙击者可以在市场热度最高时将 TokenX 逐步卖出，从而实现利润最大化。
- 但如果 TokenX 价格并未显著上涨，狙击者可以选择持有一段时间，或逐步卖出以减少损失。

e. **风险：利润不确定**

需要注意的是，狙击行为不一定保证盈利。如果 TokenX 没有受到市场欢迎，价格可能会下跌，甚至会让狙击者亏损。此外，如果有多个狙击者同时参与竞争，可能会导致价格瞬间上涨，利润空间被压缩。

#### 扫描内存池 `scan(tokens)`

https://github.com/CryptoGnome/Limit-Sniper/blob/main/sniper.py

```python
def scan(tokens):
    # 函数体...
```

**功能**：扫描内存池中的待处理交易，寻找与指定代币相关的新增流动性事件（通常是添加流动性的操作），然后根据用户配置执行购买操作。

##### 检查 DXSALE 模式

```python
if settings['DXSALE'].lower() != 'true':
    # 非DXSALE模式的代码块
else:
    # DXSALE模式的代码块
```

**目的**：根据配置文件`settings`中的`DXSALE`参数，决定采用不同的扫描和处理逻辑。

**`DXSALE`参数**：

- 如果`DXSALE`为`false`或未设置，表示不使用DXSale模式，使用常规的扫描方法。
- 如果`DXSALE`为`true`，表示使用DXSale模式，针对DXSale预售合约进行特殊处理。

> DXSale 是一个去中心化的代币预售平台，旨在帮助新项目在多个区块链网络上进行代币发行和预售，如 Binance Smart Chain（BSC）、Ethereum（以太坊）、Polygon 等。DXSale 为项目方提供了一系列工具和服务，使他们能够轻松地创建代币预售、锁定流动性和分发代币，同时为投资者提供了一个安全的环境来参与新项目的早期投资。

##### 非 DXSALE 模式的处理逻辑

```python
filter = client.eth.filter({'address': routerAddress})
pending_block = client.eth.getBlock('pending', full_transactions=True)
print(timestamp(), "Scanning Mempool & Waiting for New Liquidity Add Event..... Current Block: ", pending_block['number'])
pending_transactions = pending_block['transactions']
to_address = routerAddress
```

